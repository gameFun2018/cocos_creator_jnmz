require=function a(c,s,r){function u(t,e){if(!s[t]){if(!c[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(l)return l(t,!0);var o=new Error("Cannot find module '"+t+"'");throw o.code="MODULE_NOT_FOUND",o}var i=s[t]={exports:{}};c[t][0].call(i.exports,function(e){return u(c[t][1][e]||e)},i,i.exports,a,c,s,r)}return s[t].exports}for(var l="function"==typeof require&&require,e=0;e<r.length;e++)u(r[e]);return u}({DataManager:[function(e,t,n){"use strict";cc._RF.push(t,"f5ad31RZnlN6I5LGx7wPR/M","DataManager"),cc.Class({extends:cc.Component,properties:{CurScore:cc.Integer,BestScore:cc.Integer},start:function(){cc.log("DataManager start"),this.CurScore=0,this.BestScore=0},getCurScore:function(){return this.CurScore},setCurScore:function(e){this.CurScore=e}}),cc._RF.pop()},{}],Game:[function(e,t,n){"use strict";cc._RF.push(t,"d90819YgC1HoKWMw4GQiE1t","Game");var s=e("UIType"),r=e("SoundType"),p=0,d=1,u=2;cc.Class({extends:cc.Component,properties:{NMRootNode:{default:null,type:cc.Node},ContainerNode:{default:null,type:cc.Node},UIRoot:{default:null,type:cc.Node},DataManagerNode:{default:null,type:cc.Node},_CurGameState:cc.Integer,_NMCellNode:cc.Node,_CurMoveDir:cc.Vec2,_CurSucessCount:cc.Integer,_CurFallSpeed:cc.Integer,_ConFillCount:10,_NMCellInitPos:cc.Vec2,_SoundManagerNode:cc.Node,_CurNMRotSpeed:cc.Integer},onLoad:function(){},onDestroy:function(){},start:function(){cc.director.getCollisionManager().enabled=!0,this._SoundManagerNode=cc.find("SoundManager"),this.node.on(cc.Node.EventType.TOUCH_END,this.onGameTouchEnd,this),this._NMCellNode=this.NMRootNode.getChildByName("NMCell"),this._NMCellInitPos=this._NMCellNode.position,this._CurSucessCount=0,this._CurFallSpeed=200,this._CurNMRotSpeed=150,this.setGameState(0);null!=window.wx&&window.wx.showShareMenu({withShareTicket:!0})},onGameTouchEnd:function(e){if(console.log("Game touch end---------------------"),this._CurGameState==p){var t=this._NMCellNode.parent,n=this.NMRootNode.parent,o=t.convertToWorldSpaceAR(this._NMCellNode.position),i=n.convertToWorldSpaceAR(this.NMRootNode.position),a=cc.pSub(o,i).normalize();if(a.y<0){this._CurMoveDir=a,this.setGameState(d);var c=cc.director.getScene();this._NMCellNode.parent=c,this._NMCellNode.position=o;var s=-cc.pToAngle(a)*(180/3.14)-90;this._NMCellNode.rotation=s;var r=cc.scaleBy(.05,.85),u=cc.scaleBy(.05,1/.85),l=cc.sequence(r,u);l.setTag(1),this.NMRootNode.runAction(l)}}else this._CurGameState},changeRotateSpeed:function(e){this._CurNMRotSpeed=e;var t=this.NMRootNode.getActionByTag(0);null!=t&&this.NMRootNode.stopActionByTag(0),t=cc.rotateBy(360/this._CurNMRotSpeed,360),this.NMRootNode.runAction(cc.repeatForever(t)),t.setTag(0)},setGameState:function(e){if(this._CurGameState=e,this._CurGameState==p){if(null!=this.NMRootNode){var t=this.NMRootNode.getActionByTag(0);null==t&&(t=cc.rotateBy(360/this._CurNMRotSpeed,360),this.NMRootNode.runAction(cc.repeatForever(t)),t.setTag(0))}}else this._CurGameState==d&&(this._CurFallSpeed=150)},updateContainerProgress:function(){if(0==this._ConFillCount)return cc.log("updateContainerProgress invalid _ConFillCount "),0;var e=this.ContainerNode.getChildByName("ContainerProgressBar").getComponent(cc.ProgressBar);return e&&(e.progress=this._CurSucessCount/this._ConFillCount),e.progress},reset:function(){(this.changeRotateSpeed(150),this.setGameState(p),this._CurSucessCount=0,this.updateContainerProgress(),this.DataManagerNode)&&this.DataManagerNode.getComponent("DataManager").setCurScore(0);this.resetNMCell(),this.UIRoot.getComponent("UIManager").openUI(s.UIType_Game),this.updateScore()},resetNMCell:function(){this._NMCellNode&&(this._NMCellNode.parent=this.NMRootNode,this._NMCellNode.position=this._NMCellInitPos,this._NMCellNode.rotation=0,this._NMCellNode.scale=1)},updateScore:function(){var e=this.UIRoot.getComponent("UIManager").getUI(s.UIType_Game);if(e){var t=this.DataManagerNode.getComponent("DataManager");e.updateCurScore(t.getCurScore())}},onHitEvent:function(e){if("Bounds"==e){if(cc.log("onHitEvent Fail"),this.UIRoot){var t=this.UIRoot.getComponent("UIManager");t.closeUI(s.UIType_Game),t.openUI(s.UIType_GameOver),this._SoundManagerNode.getComponent("SoundManager").playSound(r.SoundType_Fail)}}else if("Container"==e){if(cc.log("onHitEvent Container"),this._CurSucessCount++,this.DataManagerNode){var n=this.DataManagerNode.getComponent("DataManager"),o=n.getCurScore();n.setCurScore(o+1)}this.updateScore();var i=this.updateContainerProgress();if(this.resetNMCell(),this._SoundManagerNode.getComponent("SoundManager").playSound(r.SoundType_Enter),1<=i){this.setGameState(u);var a=cc.moveTo(.5,cc.v2(-2e3,this.ContainerNode.y)),c=cc.callFunc(this.containerMoveOutFinish,this);this.ContainerNode.runAction(cc.sequence(a,c))}else this.setGameState(p)}},containerMoveOutFinish:function(e){cc.log("containerMoveOutFinish------ "),this.ContainerNode.x=2e3,this._CurSucessCount=0,this.updateContainerProgress();var t=cc.moveTo(.5,cc.v2(0,this.ContainerNode.y)),n=cc.callFunc(this.containerMoveInFinish,this);this.ContainerNode.runAction(cc.sequence(t,n)),this._SoundManagerNode.getComponent("SoundManager").playSound(r.SoundType_Move)},containerMoveInFinish:function(e){cc.log("containerMoveInFinish------ "),this.changeRotateSpeed(this._CurNMRotSpeed+5),this.setGameState(p)},update:function(e){if(1==this._CurGameState){var t=this._NMCellNode.position;this._CurFallSpeed+=300*e;var n=cc.pMult(this._CurMoveDir,this._CurFallSpeed*e);t=cc.pAdd(t,n),this._NMCellNode.position=t}}}),cc._RF.pop()},{SoundType:"SoundType",UIType:"UIType"}],NMCell:[function(e,t,n){"use strict";cc._RF.push(t,"c6482O/4kxLDZN5OguP9JCm","NMCell"),cc.Class({extends:cc.Component,properties:{_GameNode:cc.Node},start:function(){this._GameNode=cc.find("Canvas/Game")},onCollisionEnter:function(e,t){(console.log("on collision Enter "),"Cell"==t.node.group)&&(this._GameNode&&this._GameNode.getComponent("Game").onHitEvent(e.node.group))},onCollisionStay:function(e,t){},onCollisionExit:function(e,t){}}),cc._RF.pop()},{}],SoundManager:[function(e,t,n){"use strict";cc._RF.push(t,"04f46RjlnlEf4/uuERLuwnX","SoundManager");var o=e("SoundType");cc.Class({extends:cc.Component,properties:{SoundList:{default:[],type:[cc.AudioClip]},_PlayList:[]},start:function(){this.playSound(o.SoundType_Bg)},playSound:function(e){if(e.ID>=this.SoundList.length)cc.log("playSound resIndex invalid ");else{var t=cc.audioEngine.play(this.SoundList[e.ID],e.IsLoop);this._PlayList[e.ID]=t}},stopSound:function(e){e.ID>=this.SoundList.length?cc.log("playSound resIndex invalid "):-1!=this._PlayList[e.ID]&&cc.audioEngine.stop(this._PlayList[e.ID])}}),cc._RF.pop()},{SoundType:"SoundType"}],SoundType:[function(e,t,n){"use strict";cc._RF.push(t,"bfb3fvh9hRJ6aY1cftVb4tp","SoundType");t.exports={SoundType_Bg:{ID:0,IsLoop:!0},SoundType_UIClick:{ID:1,IsLoop:!1},SoundType_Enter:{ID:2,IsLoop:!1},SoundType_Fail:{ID:3,IsLoop:!1},SoundType_Move:{ID:4,IsLoop:!1}},cc._RF.pop()},{}],UIGameOver:[function(e,t,n){"use strict";cc._RF.push(t,"bdd00LDARBBy6ZSwK5EOkSS","UIGameOver");var o=e("DataManager"),i=e("UIType"),a=e("SoundType"),c=e("SoundManager");cc.Class({extends:cc.Component,properties:{LabelScore:{default:null,type:cc.Label},ButtonRetry:{default:null,type:cc.Button},ButtonRank:{default:null,type:cc.Button}},start:function(){cc.log("UIGameOver start------"),cc.log("DataManager ",o),this.ButtonRetry.node.on("click",this.onBtnRetryClick,this),this.ButtonRank.node.on("click",this.onBtnRankClick,this)},updateCurScore:function(){if(this.LabelScore){var e=cc.find("DataManager");if(e){var t=e.getComponent(o);this.LabelScore.string=t.getCurScore(),console.log("updateCurScore ",window.wx),null!=window.wx&&window.wx.postMessage({msgType:1,bestScore:t.getCurScore()})}}},updateBestScore:function(){},onEnable:function(e){cc.log("onEnable",e),this.updateCurScore()},onDisable:function(e){cc.log("onDisable",e)},onBtnRetryClick:function(e){cc.log("onBtnRetryClick",e),cc.find("Canvas/Game").getComponent("Game").reset();var t=this.node.parent;t&&t.getComponent("UIManager").closeUI(i.UIType_GameOver);cc.find("SoundManager").getComponent(c).playSound(a.SoundType_UIClick)},onBtnRankClick:function(e){if(null!=window.wx){window.wx.postMessage({msgType:2});var t=this.node.parent;if(t)t.getComponent("UIManager").openUI(i.UIType_Rank);cc.find("SoundManager").getComponent(c).playSound(a.SoundType_UIClick)}}}),cc._RF.pop()},{DataManager:"DataManager",SoundManager:"SoundManager",SoundType:"SoundType",UIType:"UIType"}],UIGame:[function(e,t,n){"use strict";cc._RF.push(t,"02b6f86sudM0IUoFVyNKPuh","UIGame"),cc.Class({extends:cc.Component,properties:{ScoreLabel:{default:null,type:cc.Label}},start:function(){},updateCurScore:function(e){this.ScoreLabel&&(this.ScoreLabel.string=e.toString())}}),cc._RF.pop()},{}],UIManager:[function(e,t,n){"use strict";cc._RF.push(t,"c8ba9cgLIZP3r6QxWWFZxad","UIManager");e("UIType");cc.Class({extends:cc.Component,properties:{UIList:{default:[],type:[cc.Node]}},start:function(){},getUIScriptName:function(e){return["UIGameOver","UIRank","UIGame"][e]},openUI:function(e){e>=this.UIList.length?cc.log("openUI invalid uiType, please check UIList"):null!=this.UIList[e]&&null!=this.UIList[e]?this.UIList[e].active=!0:cc.log("openUI invalid uiType, object null")},closeUI:function(e){e>=this.UIList.length?cc.log("closeUI invalid uiType, please check UIList"):this.UIList[e].active=!1},getUI:function(e){if(!(e>=this.UIList.length))return this.UIList[e].getComponent(this.getUIScriptName(e));cc.log("closeUI invalid uiType, please check UIList")}}),cc._RF.pop()},{UIType:"UIType"}],UIRank:[function(e,t,n){"use strict";cc._RF.push(t,"85f3bpUA0VDh5k64fKQUGS0","UIRank");var o=e("UIType"),i=e("SoundType"),a=e("SoundManager");cc.Class({extends:cc.Component,properties:{BtnClose:{default:null,type:cc.Button},Display:{default:null,type:cc.Sprite},_Texture:cc.Texture2D},start:function(){this._Texture=new cc.Texture2D,null!=window.wx&&(window.sharedCanvas.width=500,window.sharedCanvas.height=800),this.BtnClose&&this.BtnClose.node.on("click",this.onBtnCloseClick,this)},_updateSubDomainCanvas:function(){this._Texture&&window.sharedCanvas&&(this._Texture.initWithElement(window.sharedCanvas),this._Texture.handleLoadedTexture(),this.Display.spriteFrame=new cc.SpriteFrame(this._Texture))},onEnable:function(e){cc.log("onEnable",e)},onDisable:function(e){cc.log("onDisable",e)},onBtnCloseClick:function(e){cc.log("onBtnCloseClick");var t=this.node.parent;t&&t.getComponent("UIManager").closeUI(o.UIType_Rank);cc.find("SoundManager").getComponent(a).playSound(i.SoundType_UIClick)},update:function(){this._updateSubDomainCanvas()}}),cc._RF.pop()},{SoundManager:"SoundManager",SoundType:"SoundType",UIType:"UIType"}],UIType:[function(e,t,n){"use strict";cc._RF.push(t,"15d25MLiR5P4Y6I+3q4EZ4R","UIType");t.exports={UIType_GameOver:0,UIType_Rank:1,UIType_Game:2},cc._RF.pop()},{}]},{},["DataManager","Game","NMCell","SoundManager","SoundType","UIGame","UIGameOver","UIManager","UIRank","UIType"]);